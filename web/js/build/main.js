var cookieStoryApp=angular.module("cookieStoryApp",["ui.router","ngFileUpload"]);cookieStoryApp.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"views/home.html",controller:"ListeRecetteCtrl",resolve:{Recettes:function(RecetteService){return RecetteService.listeRecette().then(function(result){return result.data})},Tags:function(RecetteService){return RecetteService.listeTags().then(function(result){return result.data})}}}).state("connexion",{url:"/connect",templateUrl:"views/connexion.html",controller:"ConnexionCtrl",resolve:{Admin:function(AdminService){return null}}}).state("recette",{url:"/recette/{slug}",templateUrl:"views/recette.html",controller:"RecetteCtrl",resolve:{Recette:function($stateParams,RecetteService){return RecetteService.getRecette($stateParams.slug).then(function(result){return result.data},function(){},function(){})},Tags:function(RecetteService){return RecetteService.listeTags().then(function(result){return result.data})}}}).state("newRecette",{url:"/recette",templateUrl:"views/add.recette.html",controller:"RecetteCtrl",resolve:{Recette:function(){return null},Tags:function(RecetteService){return RecetteService.listeTags().then(function(result){return result.data})}}}).state("modifierRecette",{url:"/modifRecette/{slug}",templateUrl:"views/add.recette.html",controller:"RecetteCtrl",resolve:{Recette:function($stateParams,RecetteService){return RecetteService.getRecette($stateParams.slug).then(function(result){return result.data},function(){},function(){})},Tags:function(RecetteService){return RecetteService.listeTags().then(function(result){return result.data})}}}).state("indexRecette",{url:"/index",templateUrl:"views/index.html",controller:"ListeRecetteCtrl",resolve:{Recettes:function(RecetteService){return RecetteService.listeRecette().then(function(result){return result.data})},Tags:function(RecetteService){return RecetteService.listeTags().then(function(result){return result.data})}}}).state("categories",{url:"/categories",templateUrl:"views/categories.html",controller:"ListeRecetteCtrl",resolve:{Recettes:function(RecetteService){return RecetteService.listeRecette().then(function(result){return result.data})},Tags:function(RecetteService){return RecetteService.listeTags().then(function(result){return result.data})}}}).state("categorieListeRecette",{url:"/categorie/{slug}",templateUrl:"views/categorieListeRecette.html",controller:"ListeRecetteCtrl",resolve:{Recettes:function(RecetteService,$stateParams){return RecetteService.listeRecetteByTag($stateParams.slug).then(function(result){return result.data})},Tags:function(){return[]}}}).state("pageAdmin",{url:"/admin",templateUrl:"views/pageAdmin.html",controller:"adminCtrl",resolve:{Recettes:function(RecetteService){return RecetteService.listeRecette().then(function(result){return result.data})},Tags:function(RecetteService){return RecetteService.listeTags().then(function(result){return result.data})}}})}),cookieStoryApp.filter("reverse",function(){return function(input){return input.slice().reverse()}}),$(document).ready(function(){var limitScrollTop=parseInt($(".bandeau").offset().top);$(document).scrollTop()>=limitScrollTop&&$(".bandeau").css({position:"sticky",top:"0","z-index":"100"}),$(window).scroll(function(){var posScroll=$(document).scrollTop();console.log("posScroll : "+posScroll,"limitScrollTop : "+limitScrollTop),posScroll>=limitScrollTop?$(".bandeau").css({position:"sticky",top:"0","z-index":"100"}):$(".bandeau").css({position:"initial","z-index":"0"})})}),cookieStoryApp.controller("adminCtrl",["$scope","$state","RecetteService","Recettes","Tags","Upload",function($scope,$state,RecetteService,Recettes,Tags,Upload){$scope.recettes=Recettes,$scope.tags=Tags,$scope.newRecette=function(){$state.go("newRecette")},$scope.modifierRecette=function(recette){$state.go("modifierRecette",{slug:recette.slug})},$scope.deleteRecette=function(recette){RecetteService.deleteRecette(recette.id).then(function(){$state.reload()})},$scope.deleteTag=function(tag){RecetteService.removeTag(tag.id).then(function(){$state.reload()})},$scope.saveTag=function(){RecetteService.addTag($scope.tag).then(function(){$state.reload()})},$scope.uploadPic=function(file){file.upload=Upload.upload({url:"upload",method:"POST",file:file}),file.upload.then(function(response){response.data.success?($scope.tag.image=response.data.path,$scope.picFile=void 0):console.log(response)},function(response){},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})}}]),cookieStoryApp.controller("ConnexionCtrl",["$scope","$state","Admin","AdminService",function($scope,$state,Admin,AdminService){$scope.connexion=function(identifiant,password){var admin={identifiant:identifiant,password:password};AdminService.connexion(admin).then(function(response){"ok"==response.data.status&&$state.go("pageAdmin")})}}]),cookieStoryApp.controller("ListeRecetteCtrl",["$scope","$state","RecetteService","Recettes","Tags",function($scope,$state,RecetteService,Recettes,Tags){$scope.recettes=Recettes,$scope.tags=Tags}]),cookieStoryApp.controller("RecetteCtrl",["$scope","$state","Upload","RecetteService","Recette","Tags",function($scope,$state,Upload,RecetteService,Recette,Tags){$scope.recette=Recette||{commentaires:[],tags:[]},$scope.tags=Tags,$scope.countCommentaire=$scope.recette.commentaires.length;var position=1;$scope.contenuText="",$scope.contenuList=[],Recette?$scope.layout=Recette.layout:$scope.layout=[],$scope.addElement=function(element,contenu,pos){"titre"==element&&($scope.layout.push({item:"titre",position:pos?pos:position,contenu:contenu}),$scope.recette.titre=contenu),"imageH"==element&&$scope.layout.push({item:"imageH",position:pos?pos:position,contenu:contenu}),"story"==element&&$scope.layout.push({item:"story",position:pos?pos:position,contenu:contenu}),"recette"==element&&$scope.layout.push({item:"recette",position:pos?pos:position,contenu:contenu}),"ingredients"==element&&$scope.layout.push({item:"ingredients",position:pos?pos:position,contenu:contenu}),position++,$scope.contenuText="",$scope.contenuList=[],$scope.positionEdition=void 0},$scope.deleteElement=function(position){$scope.layout.splice(position,1)},$scope.modifierElement=function(element,index){trierLayoutParPosition(),"titre"!=element.item&&"story"!=element.item||($scope.contenuText=element.contenu,$scope.layout.splice(index,1),$scope.positionEdition=element.position),"ingredients"!=element.item&&"recette"!=element.item||($scope.contenuList=element.contenu,$scope.layout.splice(index,1),$scope.positionEdition=element.position)},$scope.monterElement=function(position){var positionTmp=$scope.layout[position].position;$scope.layout[position].position=$scope.layout[--position].position,$scope.layout[position].position=positionTmp,trierLayoutParPosition()},$scope.descendreElement=function(position){var positionTmp=$scope.layout[position].position;$scope.layout[position].position=$scope.layout[++position].position,$scope.layout[position].position=positionTmp,trierLayoutParPosition()};var trierLayoutParPosition=function(){$scope.layout=$scope.layout.sort(function(elementA,elementB){return elementA.position<elementB.position?-1:1})};$scope.addCommentaire=function(form){if(form.$valid){var commentaire={pseudo:$scope.pseudo,contenu:$scope.contenu,mail:$scope.mail,website:$scope.website,recetteId:$scope.recette.id};RecetteService.saveCommentaire(commentaire).then(function(){$state.reload()})}},$scope.addRecette=function(){var recette={titre:$scope.recette.titre,layout:$scope.layout};$scope.recette.id&&(recette.id=$scope.recette.id),RecetteService.saveRecette(recette).then(function(){$state.go("pageAdmin")})},$scope.deleteRecette=function(){RecetteService.deleteRecette($scope.recette.id).then(function(){$state.go("home")})},$scope.addTagToRecette=function(tag){RecetteService.addTagToRecette(tag.id,$scope.recette.id).then(function(response){$scope.recette.tags.push(tag)})},$scope.removeTagFromRecette=function(tag){RecetteService.removeTagFromRecette(tag.id,$scope.recette.id).then(function(response){$scope.recette.tags.sort(function(tagA,tagB){return tagB.id==tag.id}).shift()})},$scope.uploadPic=function(file){file.upload=Upload.upload({url:"upload",method:"POST",file:file}),file.upload.then(function(response){response.data.success&&($scope.addElement("imageH",response.data.path),$scope.picFile=void 0)},function(response){},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})},$scope.isNotSelectedTag=function(tag){return!$scope.recette.tags.some(function(tagRecette){return tagRecette.id==tag.id})}}]),cookieStoryApp.directive("csCommentaires",function(){return{restrict:"EC",replace:!0,scope:{elements:"=elements"},templateUrl:"js/templates/commentaires.html"}}),cookieStoryApp.directive("csImageH",function(){return{restrict:"EC",replace:!0,scope:{image:"=image"},template:"<div class='col-xs-12'><img ng-src={{image}}></img></div>"}}),cookieStoryApp.directive("csImageV",function(){return{restrict:"EC",replace:!0,scope:{image:"=image"},template:"<div class='col-xs-6'><img ng-src={{image}}></img></div>"}}),cookieStoryApp.directive("csIngredients",function(){return{restrict:"EC",replace:!0,scope:{elements:"=elements"},templateUrl:"js/templates/ingredients.html"}}),cookieStoryApp.directive("csRecette",function(){return{restrict:"EC",replace:!0,scope:{elements:"=elements"},templateUrl:"js/templates/recette.html"}}),cookieStoryApp.directive("csStory",function(){return{restrict:"EC",replace:!0,scope:{story:"=story"},template:"<div class='col-xs-12'><h2>Il etait une fois...</h2><div>{{story}}</div></div>"}}),cookieStoryApp.directive("csTitre",function(){return{restrict:"EC",replace:!0,scope:{titre:"=titre"},template:"<div class='col-xs-12'><h1>{{titre}}</h1></div>"}}),cookieStoryApp.service("AdminService",["$http",function($http){this.connexion=function(admin){return $http.post("admin/connect",{admin:admin})}}]),cookieStoryApp.service("RecetteService",["$http",function($http){this.getRecette=function(slug){return $http.get("recette/find?slug="+slug)},this.getTag=function(slug){return $http.get("tag/find?slug="+slug)},this.listeRecette=function(){return $http.get("recette/liste")},this.listeRecetteByTag=function(tagSlug){return $http.get("recette/tag?slug="+tagSlug)},this.listeTags=function(){return $http.get("tags/liste")},this.saveRecette=function(recette){return $http.post("recette/save",{recette:recette})},this.deleteRecette=function(id){return $http.delete("recette/delete?id="+id)},this.saveCommentaire=function(commentaire){return $http.post("recette/saveCommentaire",{commentaire:commentaire})},this.addTag=function(tag){return $http.post("saveTag",{tag:tag})},this.removeTag=function(tag){return $http.post("removeTag",{tag:tag})},this.addTagToRecette=function(tag,recette){return $http.post("saveTagToRecette",{tag:tag,recette:recette})},this.removeTagFromRecette=function(tag,recette){return $http.post("removeTagFromRecette",{tag:tag,recette:recette})}}]);
//# sourceMappingURL=main.js.map