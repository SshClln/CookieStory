{"version":3,"sources":["app.js","admin.controller.js","connexion.controller.js","listeRecette.controller.js","recette.controller.js","commentaires.js","images-h.js","images-v.js","ingredients.js","recette.js","story.js","titre.js","admin.service.js","authService.js","recette.service.js"],"names":["cookieStoryApp","angular","module","constant","window","_","config","$stateProvider","$urlRouterProvider","otherwise","state","url","templateUrl","controller","resolve","Recettes","RecetteService","listeRecette","then","result","data","Tags","listeTags","Admin","AdminService","Recette","$stateParams","getRecette","slug","listeRecetteByTag","abstract","authorizedRights","redirect","run","$state","AuthService","$rootScope","$on","event","next","nextParams","fromState","isAuthorized","preventDefault","go","filter","input","slice","reverse","$","document","ready","limitScrollTop","parseInt","offset","top","scrollTop","css","position","z-index","scroll","posScroll","console","log","width","$scope","Upload","recettes","tags","newRecette","modifierRecette","recette","deleteRecette","id","reload","deleteTag","tag","removeTag","saveTag","addTag","uploadPic","file","upload","method","response","success","image","path","picFile","undefined","evt","progress","Math","min","loaded","total","connexion","identifiant","password","admin","login","commentaires","countCommentaire","length","contenuText","contenuList","layout","addElement","element","contenu","pos","push","item","titre","positionEdition","deleteElement","splice","modifierElement","index","trierLayoutParPosition","monterElement","positionTmp","descendreElement","sort","elementA","elementB","addCommentaire","form","$valid","commentaire","pseudo","mail","website","recetteId","saveCommentaire","addRecette","saveRecette","addTagToRecette","removeTagFromRecette","tagA","tagB","shift","isNotSelectedTag","some","tagRecette","directive","restrict","replace","scope","elements","template","story","service","$http","this","post","$resource","$q","setUser","value","user","localStorage","setItem","JSON","stringify","setRoles","values","roles","setRights","rights","parse","getItem","deferred","defer","reject","err","promise","logout","get","isAuthenticated","intersection","getAuthenticatedUser","getTag","tagSlug","delete"],"mappings":"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","file":"main.js","sourcesContent":["// Define the `cookieStoryApp` module\r\nvar cookieStoryApp = angular.module('cookieStoryApp', ['ui.router', 'ngFileUpload', 'ngResource']);\r\ncookieStoryApp.constant('_', window._);\r\n\r\n\r\ncookieStoryApp.config(function($stateProvider, $urlRouterProvider) {\r\n\r\n    $urlRouterProvider.otherwise('/');\r\n\r\n    $stateProvider\r\n        // HOME STATES AND NESTED VIEWS ========================================\r\n        .state('home', {\r\n            url: '/',\r\n            templateUrl: 'views/home.html',\r\n            controller: 'ListeRecetteCtrl',\r\n            resolve: {\r\n              Recettes: function (RecetteService) {\r\n                return RecetteService.listeRecette().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n              Tags: function (RecetteService) {\r\n                return RecetteService.listeTags().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n            }\r\n        })\r\n        .state('connexion', {\r\n            url: '/connect',\r\n            templateUrl: 'views/connexion.html',\r\n            controller: 'ConnexionCtrl',\r\n            resolve: {\r\n              Admin: function (AdminService) {\r\n                return null;\r\n              },\r\n            }\r\n        })\r\n        .state('recette', {\r\n            url: '/recette/{slug}',\r\n            templateUrl: 'views/recette.html',\r\n            controller: 'RecetteCtrl',\r\n            resolve: {\r\n              Recette: function ($stateParams, RecetteService) {\r\n                return RecetteService.getRecette($stateParams.slug).then(function siToutEstBon (result) {\r\n                  return result.data;\r\n                }, function siQqchPlante() {\r\n\r\n                }, function pendantQueLaRequeteEstTraitée() {\r\n\r\n                })\r\n              },\r\n              Tags: function (RecetteService) {\r\n                return RecetteService.listeTags().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n            }\r\n        })\r\n        .state('newRecette', {\r\n            url: '/recette',\r\n            templateUrl: 'views/add.recette.html',\r\n            controller: 'RecetteCtrl',\r\n            resolve: {\r\n              Recette: function () {\r\n                return null;\r\n              },\r\n              Tags: function (RecetteService) {\r\n                return RecetteService.listeTags().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n            }\r\n        })\r\n        .state('modifierRecette', {\r\n            url: '/modifRecette/{slug}',\r\n            templateUrl: 'views/add.recette.html',\r\n            controller: 'RecetteCtrl',\r\n            resolve: {\r\n              Recette: function ($stateParams, RecetteService) {\r\n                return RecetteService.getRecette($stateParams.slug).then(function siToutEstBon (result) {\r\n                  return result.data;\r\n                }, function siQqchPlante() {\r\n\r\n                }, function pendantQueLaRequeteEstTraitée() {\r\n\r\n                })\r\n              },\r\n              Tags: function (RecetteService) {\r\n                return RecetteService.listeTags().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n            }\r\n        })\r\n        .state('indexRecette', {\r\n            url: '/index',\r\n            templateUrl: 'views/index.html',\r\n            controller: 'ListeRecetteCtrl',\r\n            resolve: {\r\n              Recettes: function (RecetteService) {\r\n                return RecetteService.listeRecette().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n              Tags: function (RecetteService) {\r\n                return RecetteService.listeTags().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n            }\r\n        })\r\n        .state('categories', {\r\n            url: '/categories',\r\n            templateUrl: 'views/categories.html',\r\n            controller: 'ListeRecetteCtrl',\r\n            resolve: {\r\n              Recettes: function (RecetteService) {\r\n                return RecetteService.listeRecette().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n              Tags: function (RecetteService) {\r\n                return RecetteService.listeTags().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n            }\r\n        })\r\n        .state('categorieListeRecette', {\r\n            url: '/categorie/{slug}',\r\n            templateUrl: 'views/categorieListeRecette.html',\r\n            controller: 'ListeRecetteCtrl',\r\n            resolve: {\r\n              Recettes: function (RecetteService, $stateParams) {\r\n                return RecetteService.listeRecetteByTag($stateParams.slug).then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n              Tags: function () {\r\n                return [];\r\n              },\r\n            }\r\n        })\r\n        .state('admin', {\r\n            url: \"/admin\",\r\n            abstract: true,\r\n            templateUrl: 'views/admin.html',\r\n            data: {\r\n                authorizedRights: ['admin.read'],\r\n                redirect: 'connexion'\r\n            },\r\n        })\r\n        .state('admin.pageAdmin', {\r\n            url: '/gestion',\r\n            templateUrl: 'views/pageAdmin.html',\r\n            controller: 'adminCtrl',\r\n            resolve: {\r\n              Recettes: function (RecetteService) {\r\n                return RecetteService.listeRecette().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n              Tags: function (RecetteService) {\r\n                return RecetteService.listeTags().then(function (result) {\r\n                  return result.data;\r\n                });\r\n              },\r\n            }\r\n        })\r\n});\r\n\r\ncookieStoryApp.run(function ($state, AuthService, $rootScope) {\r\n    $rootScope.$on('$stateChangeStart', function (event, next, nextParams, fromState) {\r\n        if ('data' in next && 'authorizedRights' in next.data) {\r\n            var authorizedRights = next.data.authorizedRights;\r\n            if (!AuthService.isAuthorized(authorizedRights)) {\r\n                event.preventDefault();\r\n                $state.go(next.data.redirect);\r\n            }\r\n        }\r\n    });\r\n});\r\n\r\n\r\n\r\ncookieStoryApp.filter('reverse', function() {\r\n  return function(input) {\r\n    return input.slice().reverse();\r\n  };\r\n});\r\n","cookieStoryApp.controller('adminCtrl', ['$scope', '$state', 'RecetteService', 'Recettes', 'Tags', 'Upload',\r\n  function ($scope, $state, RecetteService, Recettes, Tags, Upload)\r\n{\r\n  $scope.recettes = Recettes;\r\n  $scope.tags = Tags;\r\n\r\n  $scope.newRecette = function () {\r\n    $state.go('newRecette');\r\n  }\r\n\r\n  $scope.modifierRecette = function (recette) {\r\n    $state.go('modifierRecette', {'slug': recette.slug});\r\n  }\r\n\r\n  $scope.deleteRecette = function (recette) {\r\n    RecetteService.deleteRecette(recette.id).then(function() {\r\n      $state.reload();\r\n    });\r\n  }\r\n\r\n  $scope.deleteTag = function (tag) {\r\n    RecetteService.removeTag(tag.id).then(function() {\r\n      $state.reload();\r\n    });\r\n  }\r\n\r\n  $scope.saveTag = function () {\r\n    RecetteService.addTag($scope.tag).then(function(){ // {nom: binding html, image: path après upload}\r\n      $state.reload();\r\n    })\r\n  }\r\n\r\n  $scope.uploadPic = function(file) {\r\n    file.upload = Upload.upload({\r\n      url: 'upload',\r\n      method: 'POST',\r\n      file: file,\r\n    });\r\n\r\n    file.upload.then(function (response) {\r\n        if (response.data.success) {\r\n          $scope.tag.image = response.data.path;\r\n          $scope.picFile=undefined;\r\n        }\r\n        else{\r\n          console.log(response);\r\n        }\r\n      }, function (response) {\r\n      }, function (evt) {\r\n        // Math.min is to fix IE which reports 200% sometimes\r\n        file.progress = Math.min(100, parseInt(100.0 * evt.loaded / evt.total));\r\n      });\r\n    }\r\n\r\n}])\r\n","cookieStoryApp.controller('ConnexionCtrl', ['$scope', '$state', 'Admin', 'AuthService',\r\n  function ($scope, $state, Admin, AuthService)\r\n{\r\n  $scope.connexion = function (identifiant, password){\r\n    var admin = {identifiant:identifiant,password:password}\r\n    AuthService.login(admin).then(function(response){\r\n      if(response.data.id){\r\n        $state.go('admin.pageAdmin');\r\n      }else{\r\n\r\n      }\r\n    });\r\n  }\r\n\r\n}])\r\n","cookieStoryApp.controller('ListeRecetteCtrl', ['$scope', '$state', 'RecetteService', 'Recettes', 'Tags',\r\n  function ($scope, $state, RecetteService, Recettes, Tags)\r\n{\r\n  $scope.recettes = Recettes;\r\n  $scope.tags = Tags;\r\n\r\n}])\r\n","cookieStoryApp.controller('RecetteCtrl', ['$scope', '$state', 'Upload', 'RecetteService', 'Recette', 'Tags',\r\n  function ($scope, $state, Upload, RecetteService, Recette, Tags)\r\n{\r\n\r\n  $scope.recette = Recette || {commentaires:[], tags:[]};\r\n  $scope.tags = Tags;\r\n  $scope.countCommentaire = $scope.recette.commentaires.length;\r\n\r\n  var position = 1;\r\n\r\n  $scope.contenuText='';\r\n  $scope.contenuList = [];\r\n\r\nif (Recette){\r\n  $scope.layout=Recette.layout;\r\n}\r\nelse{\r\n  $scope.layout = [];\r\n}\r\n\r\n  $scope.addElement = function (element, contenu, pos) {\r\n    if (element == 'titre') {\r\n      $scope.layout.push({item:'titre', position:pos ? pos : position, contenu:contenu})\r\n      $scope.recette.titre = contenu;\r\n    }\r\n    if (element == 'imageH') {\r\n      $scope.layout.push({item:'imageH', position:pos ? pos : position, contenu:contenu})\r\n    }\r\n    if (element == 'story') {\r\n      $scope.layout.push({item:'story', position:pos ? pos : position, contenu:contenu})\r\n    }\r\n    if (element == 'recette') {\r\n      $scope.layout.push({item:'recette', position:pos ? pos : position, contenu:contenu})\r\n    }\r\n    if (element == 'ingredients') {\r\n      $scope.layout.push({item:'ingredients', position:pos ? pos : position, contenu:contenu})\r\n    }\r\n    position++;\r\n    $scope.contenuText='';\r\n    $scope.contenuList = [];\r\n    $scope.positionEdition = undefined;\r\n  }\r\n\r\n  $scope.deleteElement = function (position) {\r\n    $scope.layout.splice(position, 1);\r\n  }\r\n\r\n  $scope.modifierElement = function (element, index) {\r\n    trierLayoutParPosition();\r\n    if (element.item == 'titre' || element.item =='story') {\r\n      $scope.contenuText = element.contenu;\r\n      $scope.layout.splice(index, 1);\r\n      $scope.positionEdition = element.position;\r\n    }\r\n    if (element.item == 'ingredients' || element.item =='recette') {\r\n      $scope.contenuList = element.contenu;\r\n      $scope.layout.splice(index, 1);\r\n      $scope.positionEdition = element.position;\r\n    }\r\n  }\r\n\r\n  $scope.monterElement = function (position) {\r\n    var positionTmp = $scope.layout[position]['position'];\r\n    $scope.layout[position]['position'] = $scope.layout[--position]['position'];\r\n    $scope.layout[position]['position'] = positionTmp;\r\n    trierLayoutParPosition();\r\n  }\r\n\r\n  $scope.descendreElement = function (position) {\r\n    var positionTmp = $scope.layout[position]['position'];\r\n    $scope.layout[position]['position'] = $scope.layout[++position]['position'];\r\n    $scope.layout[position]['position'] = positionTmp;\r\n    trierLayoutParPosition();\r\n  }\r\n\r\n  var trierLayoutParPosition = function () {\r\n    $scope.layout = $scope.layout.sort(function (elementA, elementB) {\r\n      if (elementA.position < elementB.position) {\r\n        return -1;\r\n      }\r\n      else {\r\n        return 1;\r\n      }\r\n    })\r\n  }\r\n\r\n  $scope.addCommentaire = function (form){\r\n    if (form.$valid) {\r\n      var commentaire = {pseudo:$scope.pseudo, contenu:$scope.contenu, mail:$scope.mail, website:$scope.website, recetteId:$scope.recette.id}\r\n      RecetteService.saveCommentaire(commentaire).then(function(){\r\n        $state.reload();\r\n      });\r\n    }\r\n  }\r\n\r\n  $scope.addRecette = function () {\r\n    var recette = {titre:$scope.recette.titre, layout:$scope.layout}\r\n    if ($scope.recette.id) {\r\n      recette.id = $scope.recette.id;\r\n    }\r\n    RecetteService.saveRecette(recette).then(function () {\r\n      $state.go('pageAdmin');\r\n    });\r\n  }\r\n\r\n  $scope.deleteRecette = function () {\r\n    RecetteService.deleteRecette($scope.recette.id).then(function() {\r\n      $state.go('home');\r\n    });\r\n  }\r\n\r\n  $scope.addTagToRecette = function (tag) {\r\n      RecetteService.addTagToRecette(tag.id, $scope.recette.id).then(function (response) {\r\n          $scope.recette.tags.push(tag);\r\n      });\r\n  }\r\n\r\n  $scope.removeTagFromRecette = function (tag) {\r\n      RecetteService.removeTagFromRecette(tag.id, $scope.recette.id).then(function (response) {\r\n        $scope.recette.tags.sort(function (tagA, tagB) {\r\n          return tagB.id == tag.id\r\n        }).shift();\r\n      });\r\n  }\r\n\r\n  $scope.uploadPic = function(file) {\r\n    file.upload = Upload.upload({\r\n      url: 'upload',\r\n      method: 'POST',\r\n      file: file,\r\n    });\r\n\r\n    file.upload.then(function (response) {\r\n        if (response.data.success) {\r\n          $scope.addElement(\"imageH\", response.data.path)\r\n          $scope.picFile=undefined;\r\n        }\r\n      }, function (response) {\r\n      }, function (evt) {\r\n        // Math.min is to fix IE which reports 200% sometimes\r\n        file.progress = Math.min(100, parseInt(100.0 * evt.loaded / evt.total));\r\n      });\r\n    }\r\n\r\n    $scope.isNotSelectedTag = function (tag) {\r\n      return !$scope.recette.tags.some(function (tagRecette) {\r\n        return tagRecette.id == tag.id;\r\n      })\r\n    }\r\n}])\r\n","cookieStoryApp.directive('csCommentaires', function () {\r\n  return {\r\n      restrict: 'EC',\r\n      replace: true,\r\n      scope: {elements: '=elements'},\r\n        templateUrl: 'js/templates/commentaires.html'\r\n  }\r\n});\r\n","cookieStoryApp.directive('csImageH', function () {\r\n  return {\r\n      restrict: 'EC',\r\n      replace: true,\r\n      scope: {image: '=image'},\r\n      template: \"<div class='col-xs-12'><img ng-src={{image}}></img></div>\"\r\n  }\r\n});\r\n","cookieStoryApp.directive('csImageV', function () {\r\n  return {\r\n      restrict: 'EC',\r\n      replace: true,\r\n      scope: {image: '=image'},\r\n      template: \"<div class='col-xs-6'><img ng-src={{image}}></img></div>\"\r\n  }\r\n});\r\n","cookieStoryApp.directive('csIngredients', function () {\r\n  return {\r\n      restrict: 'EC',\r\n      replace: true,\r\n      scope: {elements: '=elements'},\r\n        templateUrl: 'js/templates/ingredients.html'\r\n  }\r\n});\r\n","cookieStoryApp.directive('csRecette', function () {\r\n  return {\r\n      restrict: 'EC',\r\n      replace: true,\r\n      scope: {elements: '=elements'},\r\n      templateUrl: 'js/templates/recette.html'\r\n  }\r\n});\r\n","cookieStoryApp.directive('csStory', function () {\r\n  return {\r\n      restrict: 'EC',\r\n      replace: true,\r\n      scope: {story: '=story'},\r\n      template: \"<div class='col-xs-12'><h2>Il etait une fois...</h2>\" +\r\n      \"<div>{{story}}</div></div>\"\r\n  }\r\n});\r\n","cookieStoryApp.directive('csTitre', function () {\r\n  return {\r\n      restrict: 'EC',\r\n      replace: true,\r\n      scope: {titre: '=titre'},\r\n      template: \"<div class='col-xs-12'><h1>{{titre}}</h1></div>\"\r\n  }\r\n});\r\n","cookieStoryApp.service('AdminService', ['$http', function ($http) {\r\n\r\n  this.connexion = function (admin) {\r\n    return $http.post('admin/connect', {'admin':admin});\r\n  }\r\n\r\n}])\r\n","cookieStoryApp.service('AuthService', ['$resource', '$http', '$q', '_', function($resource, $http, $q, _) {\r\n  var user = JSON.parse(localStorage.getItem('auth_user'));\r\n  var roles = JSON.parse(localStorage.getItem('auth_roles'));\r\n  var rights = JSON.parse(localStorage.getItem('auth_rights'));\r\n\r\n  function setUser(value) {\r\n    user = value;\r\n    localStorage.setItem('auth_user', JSON.stringify(user));\r\n  }\r\n\r\n  function setRoles(values) {\r\n      roles = values;\r\n      localStorage.setItem('auth_roles', JSON.stringify(roles));\r\n  }\r\n\r\n  function setRights(values) {\r\n      rights = values;\r\n      localStorage.setItem('auth_rights', JSON.stringify(rights));\r\n  }\r\n\r\n  this.login = function(admin) {\r\n      var deferred = $q.defer();\r\n      $http.post('admin/connect', {'admin':admin})\n        .then(function(response) {\r\n          var user = response.data;\r\n          if (user.id) {\r\n            setUser(user);\r\n\r\n            //Set Roles and Rights\r\n            setRoles([\"SUPER_ADMIN\"]); // [\"super_admin\"]\r\n            setRights([\"admin.read\"]); // [\"admin.read\"]\r\n\r\n            deferred.resolve(response);\r\n          }\r\n          else {\r\n            deferred.reject(response);\r\n          }\r\n      }, function(response) {\r\n          var err = response.data;\r\n          deferred.reject(err);\r\n      });\r\n      return deferred.promise;\r\n  };\r\n\r\n  this.logout = function() {\r\n      setUser(null);\r\n      setRoles([]);\r\n      setRights([]);\r\n\r\n      return $http.get('auth/logout');\r\n  };\r\n\r\n  this.isAuthenticated = function() {\r\n      return user !== null;\r\n  };\r\n\r\n  this.isAuthorized = function(authorizedRights) {\r\n      //console.log(\"authorizedRights : \" + JSON.stringify(authorizedRights));\r\n      if(authorizedRights.length == 0 || _.intersection(rights, authorizedRights).length > 0 ) {\r\n          return true;\r\n      } else {\r\n          return false;\r\n      }\r\n  };\r\n\r\n  this.getAuthenticatedUser = function() {\r\n      return user;\r\n  };\r\n}]);\r\n","cookieStoryApp.service('RecetteService', ['$http', function ($http) {\r\n\r\n  this.getRecette = function (slug) {\r\n    return $http.get('recette/find?slug='+slug);\r\n  }\r\n\r\n  this.getTag = function (slug) {\r\n    return $http.get('tag/find?slug='+slug);\r\n  }\r\n\r\n  this.listeRecette = function () {\r\n    return $http.get('recette/liste');\r\n  }\r\n\r\n  this.listeRecetteByTag = function (tagSlug) {\r\n    return $http.get('recette/tag?slug='+tagSlug);\r\n  }\r\n\r\n  this.listeTags = function () {\r\n    return $http.get('tags/liste');\r\n  }\r\n\r\n  this.saveRecette = function (recette) {\r\n    return $http.post('recette/save', {'recette':recette});\r\n  }\r\n\r\n  this.deleteRecette = function (id) {\r\n    return $http.delete('recette/delete?id='+id);\r\n  }\r\n\r\n  this.saveCommentaire = function (commentaire) {\r\n    return $http.post('recette/saveCommentaire', {'commentaire':commentaire});\r\n  }\r\n\r\n  this.addTag = function (tag){\r\n    return $http.post('saveTag',{'tag':tag});\r\n  }\r\n\r\n  this.removeTag = function (tag){\r\n    return $http.post('removeTag',{'tag':tag});\r\n  }\r\n\r\n  this.addTagToRecette = function (tag, recette){\r\n    return $http.post('saveTagToRecette',{'tag':tag, 'recette':recette});\r\n  }\r\n\r\n  this.removeTagFromRecette = function (tag, recette){\r\n    return $http.post('removeTagFromRecette',{'tag':tag, 'recette':recette});\r\n  }\r\n}])\r\n"],"sourceRoot":"/source/"}